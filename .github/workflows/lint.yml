# This workflow will do a clean installation of node dependencies, cache/restore them, and lint check the changed files

name: Linting

on:
  pull_request:
    types:
      - opened
      - synchronize
    branches: [ "main" ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
    - uses: ./.github/workflows/setup-node-env.yml
    
    - name: Get file changes
      id: changed_files
      uses: trilom/file-changes-action@v1.2.4
      with: 
        output: ' '
        
    - name: Echo file changes
      run: |
            echo Added files: ${{ steps.changed_files.outputs.files_added }}
            echo Changed files: ${{ steps.changed_files.outputs.files_modified }}
            echo Removed files: ${{ steps.changed_files.outputs.files_removed }}

    - uses: reviewdog/action-eslint@v1
      with:
        fail_on_error: true
        eslint_flags: -c ./.eslintrc.json --ignore-path ./.eslintignore ${{ steps.changed_files.outputs.files_added }} ${{ steps.changed_files.outputs.files_modified }}
